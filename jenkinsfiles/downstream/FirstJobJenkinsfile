import com.raresociopath.jenkins.data.Repositories
import static com.raresociopath.jenkins.data.StaticData.Jobs

node {
    timeout(time: 60, unit: 'MINUTES') {
            timestamps {
                def cfg = [
                        ref         : env.Dsl_Version,
                        scmCredsId  : env.SCM_CREDENTIALS_ID,
                        test_string : env.test_string,
                ]
                doWork(cfg)
            }
    }
}

void doWork(cfg) {

    stage("info"){
        deleteDir()
        envInfo()
        appendComment("Working with version <b>${cfg.ref}</b>")
    }

    stage("first job") {
        getShOutput("echo Hello World", true)
        getShOutput("echo ${cfg.test_string}", true)
    }

    
    stage("calling second job") {
        def deployParams = [
            delegated_string : cfg.test_string,
            other_string : "my name is Kapar",
            Dsl_Version : cfg.ref
        ]
        def result = build job: Jobs.DownstreamJob2, parameters: deployParams

    }
}